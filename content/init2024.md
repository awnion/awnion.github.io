+++
date = 2025-03-03
title = "[Edition 2024] Bash oneliner for fresh `cargo init` project"

[taxonomies]
tags = ["rust", "toml", "editorconfig", "clippy"]
+++

### Content

- `.editorconfig`
- `taplo.toml` (TOML-formatter config)
- `rustfmt.toml`
- `clippy.toml`

### Oneliner

```bash
cat <<'EOF' >.editorconfig
# EditorConfig is awesome: https://EditorConfig.org

# top-most EditorConfig file
root = true

[*]
indent_style = space
indent_size = 2
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.rs]
indent_size = 4
indent_style = space

[*.py]
indent_size = 4
indent_style = space

[Makefile]
indent_style = tab
indent_size = 8
EOF

cat <<'EOF' >taplo.toml
include = ["**/*.toml"]

[formatting]
reorder_arrays = false
# Once it will be fixed in taplo
indent_string = "    "
column_width = 80

[[rule]]
include = ["**/Cargo.toml"]
formatting.inline_table_expand = false

[[rule]]
include = ["**/Cargo.toml"]
keys = ["dependencies", "*-dependencies", "workspace.dependencies"]
formatting.reorder_keys = true

[[rule]]
include = ["Cargo.toml"]
keys = ["workspace", "members"]
formatting.reorder_arrays = true
EOF

cat <<'EOF' >rustfmt.toml
# I can't rely on contributors using .editorconfig
newline_style = "Unix"
# require the shorthand instead of it being optional
use_field_init_shorthand = true
# outdated default â€” `?` was unstable at the time
# additionally the `try!` macro is deprecated now
use_try_shorthand = true
# Max to use the 100 char width for everything or Default. See https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#use_small_heuristics
use_small_heuristics = "Max"

style_edition = "2024"
unstable_features = true

# better grepping
imports_granularity = "Item"
group_imports = "StdExternalCrate"

normalize_comments = true
reorder_impl_items = true
reorder_modules = true
wrap_comments = false

format_code_in_doc_comments = true
format_macro_bodies = true
format_macro_matchers = true
EOF

cat <<'EOF' >clippy.toml
# :schema
# There is also a scripts/clippy_wasm/clippy.toml which forbids some methods that are not available in wasm.

msrv = "1.85"

allow-unwrap-in-tests = true
type-complexity-threshold = 2000 # for our needs long types are fine

# https://rust-lang.github.io/rust-clippy/master/index.html#disallowed_macros
disallowed-macros = [
    "dbg", # TODO(emilk): consider forbidding these to encourage the use of proper log  # "std::eprint",
    # "std::eprintln",
    # "std::print",
    # "std::println",
    # "std::unimplemented", # generated by ArrowDeserialize derive-macro :(
]

# https://rust-lang.github.io/rust-clippy/master/index.html#disallowed_methods
disallowed-methods = [
    "std::env::temp_dir", # Use the tempdir crate instead  # There are many things that aren't allowed on wasm,
    # but we cannot disable them all here (because of e.g. https://github.com/rust-lang/rust-clippy/issues/10406)
    # so we do that in `clipppy_wasm.toml` instead.
    "std::thread::spawn", # Use `std::thread::Builder` and name the thread
    ## INFO: in acki-nacli project we have to use this algo anyway
    # "sha1::Digest::new",        # SHA1 is cryptographically broken
    "std::panic::catch_unwind", # We compile with `panic = "abort"`
]

# https://rust-lang.github.io/rust-clippy/master/index.html#disallowed_names
disallowed-names = []

# https://rust-lang.github.io/rust-clippy/master/index.html#disallowed_types
disallowed-types = [
    # Use the faster & simpler non-poisonable primitives in `parking_lot` instead
    # "std::sync::Mutex",
    "std::sync::RwLock",
    "std::sync::Condvar", # "std::sync::Once",  # enabled for now as the `log_once` macro uses it internally
]

# Allow-list of words for markdown in dosctrings https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
doc-valid-idents = []
EOF
```
